<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AllAI - 全能智能助手</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        doubao: '#00B42A',
                        deepseek: '#6B7280',
                        yuanbao: '#FF7D00',
                        chatgpt: '#10A37F',
                        dark: '#1F2937',
                        light: '#F3F4F6'
                    },
                    fontFamily: {
                        inter: ['Inter', 'system-ui', 'sans-serif'],
                    }
                }
            }
        }
    </script>
    <style type="text/tailwindcss">
        @layer utilities {
            .content-auto {
                content-visibility: auto;
            }
            .scrollbar-hide {
                -ms-overflow-style: none;
                scrollbar-width: none;
            }
            .scrollbar-hide::-webkit-scrollbar {
                display: none;
            }
            .message-card {
                @apply rounded-xl p-4 shadow-sm max-w-[85%] break-words;
            }
            .typing-dot {
                display: inline-block;
                width: 8px;
                height: 8px;
                border-radius: 50%;
                background-color: #6B7280;
                animation: typing 1.4s infinite ease-in-out both;
            }
            .typing-dot:nth-child(1) {
                animation-delay: -0.32s;
            }
            .typing-dot:nth-child(2) {
                animation-delay: -0.16s;
            }
            @keyframes typing {
                0%, 80%, 100% { transform: scale(0); }
                40% { transform: scale(1); }
            }
            .ai-card {
                @apply border rounded-lg p-3 hover:shadow-md transition-shadow cursor-pointer flex items-center gap-3;
            }
        }
    </style>
</head>
<body class="font-inter bg-gray-50 text-dark h-screen flex flex-col overflow-hidden">
    <!-- AI选择模态框 -->
    <div id="aiSelectModal" class="fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4 hidden">
        <div class="bg-white rounded-xl p-6 w-full max-w-lg">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-xl font-bold">选择AI智能体</h3>
                <button id="closeAiSelectBtn" class="text-gray-400 hover:text-gray-600">
                    <i class="fa fa-times"></i>
                </button>
            </div>
            <div class="space-y-3">
                <div class="ai-card border-doubao text-doubao" data-ai="doubao">
                    <div class="w-10 h-10 rounded-full bg-doubao/20 flex items-center justify-center">
                        <i class="fa fa-comments"></i>
                    </div>
                    <div>
                        <h4 class="font-medium">豆包AI</h4>
                        <p class="text-xs text-gray-500">生活助手·文案创作·知识问答</p>
                    </div>
                </div>
                <div class="ai-card border-deepseek text-deepseek" data-ai="deepseek">
                    <div class="w-10 h-10 rounded-full bg-deepseek/20 flex items-center justify-center">
                        <i class="fa fa-line-chart"></i>
                    </div>
                    <div>
                        <h4 class="font-medium">DeepSeek</h4>
                        <p class="text-xs text-gray-500">数据分析·代码解释·逻辑推理</p>
                    </div>
                </div>
                <div class="ai-card border-yuanbao text-yuanbao" data-ai="yuanbao">
                    <div class="w-10 h-10 rounded-full bg-yuanbao/20 flex items-center justify-center">
                        <i class="fa fa-home"></i>
                    </div>
                    <div>
                        <h4 class="font-medium">元宝AI</h4>
                        <p class="text-xs text-gray-500">生活技巧·实用建议·本地服务</p>
                    </div>
                </div>
                <div class="ai-card border-chatgpt text-chatgpt" data-ai="chatgpt">
                    <div class="w-10 h-10 rounded-full bg-chatgpt/20 flex items-center justify-center">
                        <i class="fa fa-code"></i>
                    </div>
                    <div>
                        <h4 class="font-medium">ChatGPT</h4>
                        <p class="text-xs text-gray-500">代码生成·编程调试·创意写作</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 主容器 -->
    <div class="flex flex-1 overflow-hidden">
        <!-- 左侧边栏 - 历史对话 -->
        <div id="historyPanel" class="w-64 bg-white border-r border-gray-200 flex flex-col hidden md:flex transition-all duration-300">
            <div class="p-4 border-b border-gray-200 flex items-center justify-between">
                <h2 class="font-bold text-lg">历史对话</h2>
                <button id="newChatBtn" class="p-2 rounded-full hover:bg-light" title="新对话">
                    <i class="fa fa-plus"></i>
                </button>
            </div>
            
            <!-- 搜索历史 -->
            <div class="p-3 border-b border-gray-200">
                <div class="relative">
                    <input type="text" id="searchHistoryInput" placeholder="搜索历史对话..." class="w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-1 focus:ring-primary focus:border-primary">
                    <i class="fa fa-search absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 text-sm"></i>
                </div>
            </div>
            
            <!-- 历史记录 -->
            <div class="flex-1 overflow-y-auto scrollbar-hide p-2" id="historyList">
                <div class="history-item p-3 rounded-lg hover:bg-light cursor-pointer active bg-light/50 border-l-2 border-chatgpt">
                    <p class="text-sm font-medium truncate">新对话</p>
                    <p class="text-xs text-gray-500 truncate mt-1">刚刚</p>
                </div>
            </div>
            
            <div class="p-4 border-t border-gray-200">
                <button id="switchAiBtn" class="flex items-center gap-2 w-full p-2 rounded-lg hover:bg-light text-sm">
                    <i class="fa fa-robot"></i>
                    <span>切换AI智能体</span>
                    <span id="currentAiName" class="ml-auto text-sm font-medium text-chatgpt">ChatGPT</span>
                </button>
            </div>
        </div>

        <!-- 中间 - 聊天区域 -->
        <div class="flex-1 flex flex-col bg-gray-50 overflow-hidden">
            <!-- 顶部导航 -->
            <div class="bg-white border-b border-gray-200 p-4 flex items-center justify-between">
                <div class="flex items-center gap-3">
                    <button id="toggleHistoryBtn" class="md:hidden p-2 rounded-full hover:bg-light">
                        <i class="fa fa-bars"></i>
                    </button>
                    <div class="flex items-center gap-2">
                        <div id="aiAvatar" class="w-10 h-10 rounded-full bg-chatgpt flex items-center justify-center text-white">
                            <i class="fa fa-code"></i>
                        </div>
                        <h1 class="font-bold">AllAI</h1>
                    </div>
                </div>
                <div class="flex items-center gap-1">
                    <button class="p-2 rounded-full hover:bg-light relative">
                        <i class="fa fa-bell-o"></i>
                        <span class="absolute top-1 right-1 w-2 h-2 bg-red-500 rounded-full"></span>
                    </button>
                </div>
            </div>

            <!-- 聊天内容区 -->
            <div id="chatContainer" class="flex-1 p-4 md:p-6 overflow-y-auto scrollbar-hide space-y-6">
                <!-- 欢迎消息 -->
                <div class="flex items-start gap-3">
                    <div id="aiAvatarWelcome" class="w-10 h-10 rounded-full bg-chatgpt flex items-center justify-center text-white flex-shrink-0">
                        <i class="fa fa-code"></i>
                    </div>
                    <div class="message-card bg-white">
                        <p>您好！我是 AllAI 智能助手，当前为您启用 <span class="font-bold text-chatgpt">ChatGPT</span> 模式，可帮您实现以下功能：</p>
                        <ul class="list-disc list-inside text-sm mt-2 ml-2 space-y-1">
                            <li>代码生成、调试、解释（Python、JavaScript等多语言）</li>
                            <li>创意写作、文案创作、故事生成</li>
                            <li>知识问答、概念解释、逻辑推理</li>
                        </ul>
                        <p class="text-xs text-gray-500 mt-2">可点击左侧“切换AI智能体”选择豆包、DeepSeek、元宝等不同助手，也可直接输入指令（如“生成Python冒泡排序代码”）</p>
                    </div>
                </div>
            </div>

            <!-- 功能工具栏 -->
            <div class="bg-white border-t border-gray-200 p-3">
                <div class="flex flex-wrap gap-1 mb-2">
                    <button class="feature-btn text-sm" data-feature="code">
                        <i class="fa fa-code text-chatgpt"></i>
                        <span>生成代码</span>
                    </button>
                    <button class="feature-btn text-sm" data-feature="write">
                        <i class="fa fa-pencil text-doubao"></i>
                        <span>创作文案</span>
                    </button>
                    <button class="feature-btn text-sm" data-feature="analyze">
                        <i class="fa fa-line-chart text-deepseek"></i>
                        <span>数据分析</span>
                    </button>
                    <button class="feature-btn text-sm" data-feature="life">
                        <i class="fa fa-home text-yuanbao"></i>
                        <span>生活助手</span>
                    </button>
                    <button class="feature-btn text-sm" data-feature="translate">
                        <i class="fa fa-language text-gray-600"></i>
                        <span>翻译</span>
                    </button>
                </div>

                <!-- 输入区域 -->
                <div class="relative">
                    <textarea 
                        id="messageInput" 
                        class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-primary focus:border-primary resize-none"
                        rows="3"
                        placeholder="输入问题或指令（支持直接触发功能：生成代码/创作文案/数据分析...）"
                    ></textarea>
                    <div class="absolute right-2 bottom-2 flex items-center gap-1">
                        <button id="voiceInputBtn" class="p-2 rounded-full hover:bg-light text-gray-600">
                            <i class="fa fa-microphone"></i>
                        </button>
                        <button id="sendMessageBtn" class="bg-chatgpt text-white p-2 rounded-full hover:bg-chatgpt/90">
                            <i class="fa fa-paper-plane"></i>
                        </button>
                    </div>
                </div>
                <p class="text-xs text-gray-500 mt-2 ml-4">按 Shift+Enter 换行，Enter 发送 | 支持直接输入"生成代码/创作文案"触发功能</p>
            </div>
        </div>
    </div>

    <script>
        // DOM元素
        const aiSelectModal = document.getElementById('aiSelectModal');
        const closeAiSelectBtn = document.getElementById('closeAiSelectBtn');
        const switchAiBtn = document.getElementById('switchAiBtn');
        const currentAiName = document.getElementById('currentAiName');
        const aiAvatar = document.getElementById('aiAvatar');
        const aiAvatarWelcome = document.getElementById('aiAvatarWelcome');
        const historyPanel = document.getElementById('historyPanel');
        const toggleHistoryBtn = document.getElementById('toggleHistoryBtn');
        const chatContainer = document.getElementById('chatContainer');
        const messageInput = document.getElementById('messageInput');
        const sendMessageBtn = document.getElementById('sendMessageBtn');
        const newChatBtn = document.getElementById('newChatBtn');
        const searchHistoryInput = document.getElementById('searchHistoryInput');
        const historyList = document.getElementById('historyList');
        const voiceInputBtn = document.getElementById('voiceInputBtn');
        const featureButtons = document.querySelectorAll('[data-feature]');
        
        // 应用状态
        let currentChatId = 'new-chat-' + Date.now();
        let chatHistory = {
            [currentChatId]: []
        };
        let favorites = [];
        let isLoading = false;
        let currentAI = 'chatgpt'; // 默认ChatGPT
        const aiConfigs = {
            doubao: { 
                name: '豆包AI', 
                color: 'doubao', 
                icon: 'fa-comments',
                features: '生活助手·文案创作·知识问答'
            },
            deepseek: { 
                name: 'DeepSeek', 
                color: 'deepseek', 
                icon: 'fa-line-chart',
                features: '数据分析·代码解释·逻辑推理'
            },
            yuanbao: { 
                name: '元宝AI', 
                color: 'yuanbao', 
                icon: 'fa-home',
                features: '生活技巧·实用建议·本地服务'
            },
            chatgpt: { 
                name: 'ChatGPT', 
                color: 'chatgpt', 
                icon: 'fa-code',
                features: '代码生成·编程调试·创意写作'
            }
        };
        
        // 初始化
        function init() {
            // 从本地存储加载数据
            loadFromLocalStorage();
            updateHistoryList();
            
            // 事件监听
            bindEvents();
        }
        
        // 绑定事件
        function bindEvents() {
            // AI选择
            switchAiBtn.addEventListener('click', () => aiSelectModal.classList.remove('hidden'));
            closeAiSelectBtn.addEventListener('click', () => aiSelectModal.classList.add('hidden'));
            document.querySelectorAll('.ai-card').forEach(card => {
                card.addEventListener('click', () => {
                    const ai = card.dataset.ai;
                    switchAI(ai);
                    aiSelectModal.classList.add('hidden');
                });
            });
            
            // 面板切换
            toggleHistoryBtn.addEventListener('click', () => {
                historyPanel.classList.toggle('hidden');
                historyPanel.classList.toggle('flex');
            });
            
            // 发送消息
            sendMessageBtn.addEventListener('click', sendMessage);
            messageInput.addEventListener('keydown', (e) => {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    sendMessage();
                }
            });
            
            // 新对话
            newChatBtn.addEventListener('click', createNewChat);
            
            // 搜索历史
            searchHistoryInput.addEventListener('input', searchHistory);
            
            // 功能按钮
            featureButtons.forEach(btn => {
                btn.addEventListener('click', () => handleFeature(btn.dataset.feature));
            });
            
            // 语音输入
            voiceInputBtn.addEventListener('click', () => {
                showNotification('正在聆听...');
                setTimeout(() => {
                    const voiceText = "这是一段语音输入的示例文本，您可以直接编辑或发送。";
                    messageInput.value = voiceText;
                    showNotification('语音识别完成');
                }, 2000);
            });
        }
        
        // 切换AI智能体
        function switchAI(ai) {
            currentAI = ai;
            const config = aiConfigs[ai];
            currentAiName.textContent = config.name;
            aiAvatar.className = `w-10 h-10 rounded-full bg-${config.color} flex items-center justify-center text-white`;
            aiAvatar.innerHTML = `<i class="fa ${config.icon}"></i>`;
            aiAvatarWelcome.className = `w-10 h-10 rounded-full bg-${config.color} flex items-center justify-center text-white flex-shrink-0`;
            aiAvatarWelcome.innerHTML = `<i class="fa ${config.icon}"></i>`;
            sendMessageBtn.className = `bg-${config.color} text-white p-2 rounded-full hover:bg-${config.color}/90`;
            
            // 更新欢迎语
            const welcomeMsg = document.querySelector('#chatContainer .message-card');
            if (welcomeMsg) {
                welcomeMsg.innerHTML = `
                    <p>您好！我是 AllAI 智能助手，当前为您启用 <span class="font-bold text-${config.color}">${config.name}</span> 模式，可帮您实现以下功能：</p>
                    <ul class="list-disc list-inside text-sm mt-2 ml-2 space-y-1">
                        <li>${config.features}</li>
                    </ul>
                    <p class="text-xs text-gray-500 mt-2">可点击左侧“切换AI智能体”选择其他助手，也可直接输入指令</p>
                `;
            }
            
            saveToLocalStorage();
        }
        
        // 搜索历史记录
        function searchHistory() {
            const query = searchHistoryInput.value.toLowerCase().trim();
            if (!query) {
                updateHistoryList();
                return;
            }
            
            const filteredChatIds = Object.keys(chatHistory).filter(chatId => {
                const chat = chatHistory[chatId];
                return chat.some(msg => 
                    msg.type === 'text' && msg.content.toLowerCase().includes(query)
                );
            });
            
            renderFilteredHistory(filteredChatIds);
        }
        
        // 渲染过滤后的历史记录
        function renderFilteredHistory(chatIds) {
            historyList.innerHTML = '';
            if (chatIds.length === 0) {
                historyList.innerHTML = `
                    <div class="text-center py-6">
                        <i class="fa fa-search text-2xl text-gray-300 mb-2"></i>
                        <p class="text-sm text-gray-500">未找到匹配的历史记录</p>
                    </div>
                `;
                return;
            }
            
            chatIds.sort((a, b) => new Date(b.split('-')[1]) - new Date(a.split('-')[1]));
            
            chatIds.forEach(chatId => {
                const chat = chatHistory[chatId];
                if (chat.length === 0) return;
                
                const lastMessage = chat[chat.length - 1];
                const previewText = lastMessage.type === 'text' 
                    ? lastMessage.content.substring(0, 20) + (lastMessage.content.length > 20 ? '...' : '')
                    : (lastMessage.role === 'user' ? '上传了文件' : '生成了内容');
                
                const date = new Date(chatId.split('-')[1]);
                const timeString = `${date.getHours().toString().padStart(2, '0')}:${date.getMinutes().toString().padStart(2, '0')}`;
                
                const historyItem = document.createElement('div');
                historyItem.className = `history-item p-3 rounded-lg hover:bg-light cursor-pointer ${chatId === currentChatId ? `bg-light/50 border-l-2 border-${aiConfigs[currentAI].color}` : ''}`;
                historyItem.innerHTML = `
                    <p class="text-sm font-medium truncate">${previewText}</p>
                    <p class="text-xs text-gray-500 truncate mt-1">${timeString}</p>
                `;
                
                historyItem.addEventListener('click', () => {
                    switchToChat(chatId);
                });
                
                historyList.appendChild(historyItem);
            });
        }
        
        // 处理功能按钮点击
        function handleFeature(feature) {
            switch(feature) {
                case 'code':
                    messageInput.value = '生成代码：';
                    messageInput.focus();
                    break;
                case 'write':
                    messageInput.value = '创作文案：';
                    messageInput.focus();
                    break;
                case 'analyze':
                    messageInput.value = '数据分析：';
                    messageInput.focus();
                    break;
                case 'life':
                    messageInput.value = '生活建议：';
                    messageInput.focus();
                    break;
                case 'translate':
                    messageInput.value = '翻译：';
                    messageInput.focus();
                    break;
            }
        }
        
        // 发送消息
        function sendMessage() {
            const content = messageInput.value.trim();
            if (!content) return;
            
            // 添加用户消息
            addMessageToChat('user', { type: 'text', content });
            messageInput.value = '';
            
            // 处理消息并生成AI回复
            handleMessageProcessing(content);
        }
        
        // 处理消息并生成AI回复
        function handleMessageProcessing(content) {
            isLoading = true;
            const loadingHtml = `
                <div class="flex items-start gap-3">
                    <div id="aiAvatarLoading" class="w-10 h-10 rounded-full bg-${aiConfigs[currentAI].color} flex items-center justify-center text-white flex-shrink-0">
                        <i class="fa ${aiConfigs[currentAI].icon}"></i>
                    </div>
                    <div class="message-card bg-white">
                        <div class="flex items-center gap-2 py-3">
                            <span class="typing-dot"></span>
                            <span class="typing-dot"></span>
                            <span class="typing-dot"></span>
                        </div>
                    </div>
                </div>
            `;
            chatContainer.insertAdjacentHTML('beforeend', loadingHtml);
            scrollToBottom();
            
            setTimeout(() => {
                isLoading = false;
                const loadingEl = document.getElementById('aiAvatarLoading').closest('div');
                if (loadingEl) loadingEl.remove();
                
                let response = '';
                switch(currentAI) {
                    case 'doubao':
                        response = generateDoubaoResponse(content);
                        break;
                    case 'deepseek':
                        response = generateDeepSeekResponse(content);
                        break;
                    case 'yuanbao':
                        response = generateYuanbaoResponse(content);
                        break;
                    case 'chatgpt':
                        response = generateChatGPTResponse(content);
                        break;
                }
                
                addMessageToChat('ai', { type: 'text', content: response });
            }, 2000 + Math.random() * 1500);
        }
        
        // 豆包AI响应
        function generateDoubaoResponse(content) {
            const writingExamples = {
                "产品宣传文案": `
                    <p><strong>【智能降噪耳机：听见世界，更听见自己】</strong></p>
                    <p>在喧嚣都市中，您是否渴望一片属于自己的宁静？我们的智能降噪耳机，采用新一代主动降噪技术，可消除99%环境噪音，让您沉浸在纯净音质中。无论是通勤路上的片刻休憩，还是深夜里的音乐盛宴，它都是您的听觉伴侣。轻触操控，持久续航，让每一次聆听都成为享受。</p>
                `,
                "故事开头": `
                    <p><strong>《时间的邮差》</strong></p>
                    <p>林墨第一次注意到那个邮差时，是在一个下着细雨的周三午后。他穿着洗得发白的绿色制服，戴着一顶旧旧的鸭舌帽，正将一封边缘泛黄的信件塞进23号信箱。奇怪的是，那封信上既没有邮票，也没有收件人地址，只在角落用铅笔写着一行小字：“请于明日黎明前送达，逾期不候。”从那天起，林墨的生活开始变得不再寻常...</p>
                `,
                "知识问答": `
                    <p><strong>关于“元宇宙”的解释：</strong></p>
                    <p>元宇宙是一个融合了虚拟现实（VR）、增强现实（AR）、区块链、人工智能等技术的虚拟空间，用户可以通过数字 avatar（化身）在其中社交、工作、娱乐，实现与现实世界平行的“第二人生”。它的核心特点包括去中心化、沉浸感、经济系统（如虚拟资产交易）和持续存在性。</p>
                `
            };
            
            const randomWriting = Object.values(writingExamples)[Math.floor(Math.random() * Object.values(writingExamples).length)];
            return `
                <p>根据您的需求，以下是为您生成的内容：</p>
                ${writingExamples[content] || randomWriting}
                <p class="mt-2 text-sm text-gray-500">需要调整风格或补充细节吗？</p>
            `;
        }
        
        // DeepSeek响应
        function generateDeepSeekResponse(content) {
            const analysisExamples = {
                "销售数据趋势": `
                    <p><strong>销售数据趋势分析（2023年Q1-Q3）</strong></p>
                    <p>从数据来看，2023年公司销售额呈现“季度递增”趋势：Q1为500万，Q2增长至750万（同比+50%），Q3突破1000万（同比+33%）。增长主要源于新产品线的市场拓展（贡献40%新增收入）和老客户复购率提升（从30%升至45%）。建议Q4加大市场投放，巩固现有增长势头。</p>
                `,
                "代码解释": `
                    <p><strong>Python冒泡排序代码解释</strong></p>
                    <pre class="bg-dark text-white p-3 rounded-lg text-sm overflow-x-auto">
def bubble_sort(arr):
    n = len(arr)
    for i in range(n):
        # 最后i个元素已排好序，无需再比较
        for j in range(0, n-i-1):
            if arr[j] > arr[j+1]:
                # 交换元素
                arr[j], arr[j+1] = arr[j+1], arr[j]
    return arr
                    </pre>
                    <p>这段代码的核心逻辑是：通过两层循环，每次将未排序部分的最大元素“冒泡”到已排序部分的末尾。外层循环控制排序轮数，内层循环负责相邻元素的比较和交换。时间复杂度为O(n²)，空间复杂度为O(1)，适合小规模数据的排序场景。</p>
                `
            };
            
            const randomAnalysis = Object.values(analysisExamples)[Math.floor(Math.random() * Object.values(analysisExamples).length)];
            return `
                <p>根据您的需求，以下是分析结果：</p>
                ${analysisExamples[content] || randomAnalysis}
                <p class="mt-2 text-sm text-gray-500">需要更深入的分析或调整维度吗？</p>
            `;
        }
        
        // 元宝AI响应
        function generateYuanbaoResponse(content) {
            const lifeExamples = {
                "家务窍门": `
                    <p><strong>家务清洁小窍门</strong></p>
                    <ul class="list-disc list-inside text-sm mt-2 ml-2 space-y-1">
                        <li>清理水垢：用白醋浸泡30分钟后擦拭，再用清水冲洗即可光亮如新。</li>
                        <li>去除油污：先用面粉涂抹在油污处吸附油脂，再用湿布擦拭，轻松去油。</li>
                        <li>镜子防雾：洗澡前在镜子上涂一层肥皂，再用干布擦干，可保持几小时不起雾。</li>
                        <li>毛衣去球：用电动剃毛器轻轻滑过毛衣表面，快速去除毛球且不损伤衣物。</li>
                    </ul>
                `,
                "健康建议": `
                    <p><strong>日常健康小建议</strong></p>
                    <ul class="list-disc list-inside text-sm mt-2 ml-2 space-y-1">
                        <li>每日饮水量：建议喝1500-2000ml水，少量多次饮用，避免一次性大量饮水。</li>
                        <li>最佳入睡时间：成年人每天需7-8小时睡眠，建议22:00-23:00入睡，保证深度睡眠时间。</li>
                        <li>久坐提醒：每久坐1小时，起身活动5分钟，做拉伸或散步，预防颈椎腰椎问题。</li>
                        <li>饮食均衡：每日摄入五谷杂粮、蔬菜水果、肉蛋奶类，保持营养均衡，增强免疫力。</li>
                    </ul>
                `,
                "生活礼仪": `
                    <p><strong>基本生活礼仪规范</strong></p>
                    <ul class="list-disc list-inside text-sm mt-2 ml-2 space-y-1">
                        <li>握手礼仪：注视对方，力度适中，时间3-5秒，避免过紧或过松。</li>
                        <li>公共场所：不大声喧哗，手机调至静音，不影响他人。</li>
                        <li>用餐礼仪：不随意翻搅菜肴，咀嚼时闭紧嘴巴，不发出声响。</li>
                        <li>排队礼仪：自觉排队，不插队，与前后保持适当距离，尊重他人权益。</li>
                    </ul>
                `
            };
            
            const randomLife = Object.values(lifeExamples)[Math.floor(Math.random() * Object.values(lifeExamples).length)];
            return `
                <p>根据您的需求，以下是生活建议：</p>
                ${lifeExamples[content] || randomLife}
                <p class="mt-2 text-sm text-gray-500">需要更具体的场景建议吗？</p>
            `;
        }
        
        // ChatGPT响应
        function generateChatGPTResponse(content) {
            const codeExamples = {
                "Python冒泡排序": `
<pre class="bg-dark text-white p-3 rounded-lg text-sm overflow-x-auto">
def bubble_sort(arr):
    n = len(arr)
    for i in range(n):
        for j in range(0, n-i-1):
            if arr[j] > arr[j+1]:
                arr[j], arr[j+1] = arr[j+1], arr[j]
    return arr

# 示例
arr = [64, 34, 25, 12, 22, 11, 90]
print("排序前:", arr)
bubble_sort(arr)
print("排序后:", arr)
</pre>
`,
                "JavaScript计算器": `
<pre class="bg-dark text-white p-3 rounded-lg text-sm overflow-x-auto">
<!DOCTYPE html>
<html>
<head>
    <title>JavaScript计算器</title>
    <style>
        .calculator {
            width: 300px;
            margin: 0 auto;
            padding: 20px;
            border: 1px solid #ccc;
            border-radius: 5px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }
        .display {
            width: 100%;
            height: 50px;
            margin-bottom: 10px;
            font-size: 24px;
            text-align: right;
        }
        .buttons {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 5px;
        }
        button {
            height: 60px;
            font-size: 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        .operator {
            background-color: #f0f0f0;
        }
        .equal {
            background-color: #4CAF50;
            color: white;
        }
    </style>
</head>
<body>
    <div class="calculator">
        <input type="text" class="display" id="display" readonly>
        <div class="buttons">
            <button onclick="clearDisplay()">C</button>
            <button onclick="appendToDisplay('()')">(</button>
            <button onclick="appendToDisplay(')')">)</button>
            <button onclick="appendToDisplay('/')" class="operator">÷</button>
            <button onclick="appendToDisplay('7')">7</button>
            <button onclick="appendToDisplay('8')">8</button>
            <button onclick="appendToDisplay('9')">9</button>
            <button onclick="appendToDisplay('*')" class="operator">×</button>
            <button onclick="appendToDisplay('4')">4</button>
            <button onclick="appendToDisplay('5')">5</button>
            <button onclick="appendToDisplay('6')">6</button>
            <button onclick="appendToDisplay('-')" class="operator">-</button>
            <button onclick="appendToDisplay('1')">1</button>
            <button onclick="appendToDisplay('2')">2</button>
            <button onclick="appendToDisplay('3')">3</button>
            <button onclick="appendToDisplay('+')" class="operator">+</button>
            <button onclick="appendToDisplay('0')">0</button>
            <button onclick="appendToDisplay('.')">.</button>
            <button onclick="calculate()" class="equal">=</button>
        </div>
    </div>

    <script>
        const display = document.getElementById('display');

        function appendToDisplay(value) {
            display.value += value;
        }

        function clearDisplay() {
            display.value = '';
        }

        function calculate() {
            try {
                display.value = eval(display.value);
            } catch (error) {
                display.value = '错误';
            }
        }
    </script>
</body>
</html>
</pre>
`
            };
            
            const randomCode = Object.values(codeExamples)[Math.floor(Math.random() * Object.values(codeExamples).length)];
            return `
                <p>根据您的需求，生成以下内容：</p>
                ${codeExamples[content] || randomCode}
                <p class="mt-2 text-sm text-gray-500">需要调整功能或解释代码吗？</p>
            `;
        }
        
        // 添加消息到聊天界面
        function addMessageToChat(role, message) {
            // 保存到历史记录
            if (!chatHistory[currentChatId]) {
                chatHistory[currentChatId] = [];
            }
            chatHistory[currentChatId].push({
                role,
                ...message,
                timestamp: new Date().toISOString()
            });
            saveToLocalStorage();
            updateHistoryList();
            
            let messageHtml = '';
            
            if (role === 'user') {
                messageHtml = `
                    <div class="flex items-start gap-3 justify-end">
                        <div class="message-card bg-primary/10">
                            ${message.type === 'text' ? 
                                `<p>${message.content}</p>` : 
                                `<img src="${message.content}" alt="用户上传的内容" class="w-full h-auto rounded-lg">`
                            }
                            <div class="mt-2 flex gap-1 justify-end">
                                <button class="text-xs p-1 text-gray-500 hover:text-primary" title="收藏">
                                    <i class="fa fa-star-o"></i>
                                </button>
                                <button class="text-xs p-1 text-gray-500 hover:text-primary" title="转发">
                                    <i class="fa fa-share-alt"></i>
                                </button>
                            </div>
                        </div>
                        <div class="w-10 h-10 rounded-full bg-gray-200 flex items-center justify-center flex-shrink-0">
                            <i class="fa fa-user text-gray-600"></i>
                        </div>
                    </div>
                `;
            } else {
                messageHtml = `
                    <div class="flex items-start gap-3">
                        <div id="aiAvatarMsg" class="w-10 h-10 rounded-full bg-${aiConfigs[currentAI].color} flex items-center justify-center text-white flex-shrink-0">
                            <i class="fa ${aiConfigs[currentAI].icon}"></i>
                        </div>
                        <div class="message-card bg-white">
                            ${message.content}
                            <div class="mt-2 flex gap-1 justify-end">
                                <button class="text-xs p-1 text-gray-500 hover:text-primary" title="收藏">
                                    <i class="fa fa-star-o"></i>
                                </button>
                                <button class="text-xs p-1 text-gray-500 hover:text-primary" title="转发">
                                    <i class="fa fa-share-alt"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            }
            
            chatContainer.insertAdjacentHTML('beforeend', messageHtml);
            scrollToBottom();
            
            // 绑定收藏和转发按钮事件
            bindMessageActions();
        }
        
        // 绑定消息的收藏和转发功能
        function bindMessageActions() {
            const favoriteButtons = chatContainer.querySelectorAll('.fa-star-o').forEach(btn => {
                btn.addEventListener('click', function(e) {
                    e.stopPropagation();
                    this.classList.toggle('fa-star-o');
                    this.classList.toggle('fa-star');
                    this.classList.toggle('text-yellow-400');
                    
                    const messageText = this.closest('.message-card').querySelector('p').textContent;
                    const isFavorite = this.classList.contains('fa-star');
                    
                    if (isFavorite) {
                        favorites.push({
                            id: 'fav-' + Date.now(),
                            text: messageText.substring(0, 50) + (messageText.length > 50 ? '...' : ''),
                            chatId: currentChatId,
                            timestamp: new Date().toISOString()
                        });
                        showNotification('已收藏该消息');
                    } else {
                        const index = favorites.findIndex(fav => fav.text === messageText.substring(0, 50));
                        if (index > -1) favorites.splice(index, 1);
                        showNotification('已取消收藏');
                    }
                    
                    saveToLocalStorage();
                });
            });
            
            const shareButtons = chatContainer.querySelectorAll('.fa-share-alt').forEach(btn => {
                btn.addEventListener('click', function(e) {
                    e.stopPropagation();
                    const messageText = this.closest('.message-card').querySelector('p').textContent;
                    navigator.clipboard.writeText(messageText).then(() => {
                        showNotification('消息已复制到剪贴板，可粘贴转发');
                    });
                });
            });
        }
        
        // 创建新对话
        function createNewChat() {
            currentChatId = 'chat-' + Date.now();
            chatHistory[currentChatId] = [];
            chatContainer.innerHTML = `
                <div class="flex items-start gap-3">
                    <div id="aiAvatarWelcome" class="w-10 h-10 rounded-full bg-${aiConfigs[currentAI].color} flex items-center justify-center text-white flex-shrink-0">
                        <i class="fa ${aiConfigs[currentAI].icon}"></i>
                    </div>
                    <div class="message-card bg-white">
                        <p>您好！我是 AllAI 智能助手，当前为您启用 <span class="font-bold text-${aiConfigs[currentAI].color}">${aiConfigs[currentAI].name}</span> 模式，可帮您实现以下功能：</p>
                        <ul class="list-disc list-inside text-sm mt-2 ml-2 space-y-1">
                            <li>${aiConfigs[currentAI].features}</li>
                        </ul>
                        <p class="text-xs text-gray-500 mt-2">请输入您的问题或指令，支持直接触发功能（如“生成Python冒泡排序代码”）</p>
                    </div>
                </div>
            `;
            saveToLocalStorage();
            updateHistoryList();
            messageInput.value = '';
        }
        
        // 更新历史对话列表
        function updateHistoryList() {
            historyList.innerHTML = '';
            
            const sortedChatIds = Object.keys(chatHistory).sort((a, b) => 
                new Date(b.split('-')[1]) - new Date(a.split('-')[1])
            );
            
            sortedChatIds.forEach(chatId => {
                const chat = chatHistory[chatId];
                if (chat.length === 0) return;
                
                const lastMessage = chat[chat.length - 1];
                const previewText = lastMessage.type === 'text' 
                    ? lastMessage.content.substring(0, 20) + (lastMessage.content.length > 20 ? '...' : '')
                    : (lastMessage.role === 'user' ? '上传了文件' : '生成了内容');
                
                const date = new Date(chatId.split('-')[1]);
                const timeString = `${date.getHours().toString().padStart(2, '0')}:${date.getMinutes().toString().padStart(2, '0')}`;
                
                const historyItem = document.createElement('div');
                historyItem.className = `history-item p-3 rounded-lg hover:bg-light cursor-pointer ${chatId === currentChatId ? `bg-light/50 border-l-2 border-${aiConfigs[currentAI].color}` : ''}`;
                historyItem.innerHTML = `
                    <p class="text-sm font-medium truncate">${previewText}</p>
                    <p class="text-xs text-gray-500 truncate mt-1">${timeString}</p>
                `;
                
                historyItem.addEventListener('click', () => {
                    switchToChat(chatId);
                });
                
                historyList.appendChild(historyItem);
            });
        }
        
        // 切换到指定对话
        function switchToChat(chatId) {
            currentChatId = chatId;
            renderChat();
            updateHistoryList();
            
            if (window.innerWidth < 768) {
                historyPanel.classList.add('hidden');
                historyPanel.classList.remove('flex');
            }
        }
        
        // 渲染当前对话
        function renderChat() {
            chatContainer.innerHTML = '';
            const chat = chatHistory[currentChatId] || [];
            
            if (chat.length === 0) {
                chatContainer.innerHTML = `
                    <div class="flex items-start gap-3">
                        <div id="aiAvatarWelcome" class="w-10 h-10 rounded-full bg-${aiConfigs[currentAI].color} flex items-center justify-center text-white flex-shrink-0">
                            <i class="fa ${aiConfigs[currentAI].icon}"></i>
                        </div>
                        <div class="message-card bg-white">
                            <p>您好！我是 AllAI 智能助手，当前为您启用 <span class="font-bold text-${aiConfigs[currentAI].color}">${aiConfigs[currentAI].name}</span> 模式，可帮您实现以下功能：</p>
                            <ul class="list-disc list-inside text-sm mt-2 ml-2 space-y-1">
                                <li>${aiConfigs[currentAI].features}</li>
                            </ul>
                            <p class="text-xs text-gray-500 mt-2">请输入您的问题或指令，支持直接触发功能（如“生成Python冒泡排序代码”）</p>
                        </div>
                    </div>
                `;
                return;
            }
            
            chat.forEach(message => {
                let messageHtml = '';
                
                if (message.role === 'user') {
                    messageHtml = `
                        <div class="flex items-start gap-3 justify-end">
                            <div class="message-card bg-primary/10">
                                ${message.type === 'text' ? 
                                    `<p>${message.content}</p>` : 
                                    `<img src="${message.content}" alt="用户上传的内容" class="w-full h-auto rounded-lg">`
                                }
                                <div class="mt-2 flex gap-1 justify-end">
                                    <button class="text-xs p-1 text-gray-500 hover:text-primary" title="收藏">
                                        <i class="fa fa-star-o"></i>
                                    </button>
                                    <button class="text-xs p-1 text-gray-500 hover:text-primary" title="转发">
                                        <i class="fa fa-share-alt"></i>
                                    </button>
                                </div>
                            </div>
                            <div class="w-10 h-10 rounded-full bg-gray-200 flex items-center justify-center flex-shrink-0">
                                <i class="fa fa-user text-gray-600"></i>
                            </div>
                        </div>
                    `;
                } else {
                    messageHtml = `
                        <div class="flex items-start gap-3">
                            <div class="w-10 h-10 rounded-full bg-${aiConfigs[currentAI].color} flex items-center justify-center text-white flex-shrink-0">
                                <i class="fa ${aiConfigs[currentAI].icon}"></i>
                            </div>
                            <div class="message-card bg-white">
                                ${message.content}
                                <div class="mt-2 flex gap-1 justify-end">
                                    <button class="text-xs p-1 text-gray-500 hover:text-primary" title="收藏">
                                        <i class="fa fa-star-o"></i>
                                    </button>
                                    <button class="text-xs p-1 text-gray-500 hover:text-primary" title="转发">
                                        <i class="fa fa-share-alt"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    `;
                }
                
                chatContainer.insertAdjacentHTML('beforeend', messageHtml);
            });
            
            scrollToBottom();
            bindMessageActions();
        }
        
        // 滚动到底部
        function scrollToBottom() {
            chatContainer.scrollTop = chatContainer.scrollHeight;
        }
        
        // 显示通知
        function showNotification(message) {
            const notification = document.createElement('div');
            notification.className = 'fixed bottom-4 right-4 bg-dark text-white px-4 py-2 rounded-lg shadow-lg z-50 transform translate-y-10 opacity-0 transition-all duration-300';
            notification.textContent = message;
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.classList.remove('translate-y-10', 'opacity-0');
            }, 10);
            
            setTimeout(() => {
                notification.classList.add('translate-y-10', 'opacity-0');
                setTimeout(() => {
                    document.body.removeChild(notification);
                }, 300);
            }, 3000);
        }
        
        // 保存到本地存储
        function saveToLocalStorage() {
            localStorage.setItem('allAiChatHistory', JSON.stringify(chatHistory));
            localStorage.setItem('allAiFavorites', JSON.stringify(favorites));
            localStorage.setItem('allAiCurrentAI', currentAI);
        }
        
        // 从本地存储加载
        function loadFromLocalStorage() {
            const savedHistory = localStorage.getItem('allAiChatHistory');
            const savedFavorites = localStorage.getItem('allAiFavorites');
            const savedAI = localStorage.getItem('allAiCurrentAI');
            
            if (savedHistory) {
                chatHistory = JSON.parse(savedHistory);
            }
            
            if (savedFavorites) {
                favorites = JSON.parse(savedFavorites);
            }
            
            if (savedAI) {
                currentAI = savedAI;
                switchAI(currentAI);
            }
        }
        
        // 初始化应用
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
